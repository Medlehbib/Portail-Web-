{% extends "base.html" %}
{% block title %}Annonces disponible{% endblock %}
{% block content %}

<div class="container mt-4">
    <div class="row">

        <!-- Colonne de droite : Cat√©gories -->
        <!-- Colonne de droite : Cat√©gories -->

            <aside class="col-md-3" style="height: 100%; overflow-y: auto;">
            <h4 class="bg-light p-2">Cat√©gories</h4>

            {% for categorie, color in categories %}
                <a href="{% url 'A_AD:articles_par_categorie' categorie.id %}" class="text-decoration-none">
                    <div class="card shadow-sm mb-3 border-0 overflow-hidden bg-{{ color }}" style="border-radius: 15px; height: 120px;">
                        <div class="card-body text-center text-white d-flex align-items-center justify-content-center">
                            <h5 class="card-title m-0">{{ categorie.nom }}</h5>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </aside>





        <!-- Colonne centrale : Actualit√©s -->
        <main class="col-md-6">
            <h4 class="bg-light p-2">Derni√®res Actualit√©s</h4>

            {% for article in articles %}
                <div class="card mb-3">
                    {% if article.image %}
                        <img src="{{ article.image.url }}" alt="Image de l'article" style="width:100%; height: 300px">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ article.titre }}</h5>
                        <p class="card-text">{{ article.contenu }}</p>
                        <div class="d-flex align-items-center gap-2">
                            <p class="badge bg-{{article.categorie.color}} mb-0 d-flex align-items-center justify-content-center " style="height: 30px;">{{ article.categorie.nom }}</p>
                            <a href="{% url 'A_AD:Article-detail' article.id %}" target="_blank" class="btn btn-primary d-flex align-items-center justify-content-center" style="height: 30px; line-height: 30px;">Lire plus</a>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>Aucune actualit√© disponible.</p>
            {% endfor %}

            <!-- Pagination Articles -->
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if articles.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?article_page={{ articles.previous_page_number }}">Pr√©c√©dent</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Pr√©c√©dent</span></li>
                    {% endif %}

                    {% for num in articles.paginator.page_range %}
                        {% if articles.number == num %}
                            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="?article_page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if articles.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?article_page={{ articles.next_page_number }}">Suivant</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Suivant</span></li>
                    {% endif %}
                </ul>
            </nav>

        </main>

        <!-- Colonne de gauche : Annonces -->
        <aside class="col-md-3">
            <h4 class="bg-light p-2">Annonces</h4>

            {% for annonce in annonces %}
                <div class="mb-3">
                    <div class="card shadow-sm">
                        {% if annonce.image %}
                            <img src="{{ annonce.image.url }}" class="card-img-top" alt="{{ annonce.titre }}">
                        {% else %}
                            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Image par d√©faut">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ annonce.titre }}</h5>
                            <p class="card-text">{{ annonce.description|truncatewords:20 }}</p>
                            <p><strong>Prix:</strong> {{ annonce.prix }} MRU</p>
                            <p><span class="text-muted">Publi√© le {{ annonce.date_pub|date:"d M Y H:i" }}</span></p>
                            <a href="{% url 'A_AD:commander-annonce' annonce.id %}" class="btn btn-primary btn-sm">
                                Commander üìù
                            </a>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>Aucune annonce disponible.</p>
            {% endfor %}

            <!-- Pagination Annonces -->
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if annonces.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?annonce_page={{ annonces.previous_page_number }}">Pr√©c√©dent</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Pr√©c√©dent</span></li>
                    {% endif %}

                    {% for num in annonces.paginator.page_range %}
                        {% if annonces.number == num %}
                            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="?annonce_page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if annonces.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?annonce_page={{ annonces.next_page_number }}">Suivant</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Suivant</span></li>
                    {% endif %}
                </ul>
            </nav>

        </aside>

    </div>
</div>

{% endblock %}
